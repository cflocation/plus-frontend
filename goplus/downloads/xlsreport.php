<?php	ini_set('max_execution_time','0');	ini_set("display_errors",1);	//phpEXCEL Classes	require_once 'Classes/PHPExcel.php';				//GETTING PROPOSAL DATA	require_once 'service_data.php';	$styleCellBorders = array(	           	'style' => PHPExcel_Style_Border::BORDER_THIN,	           	'color' => array('rgb' => 'CCCCCCCC')	);	$styleHead2 = array(	        			 'font'  => array(	                						 'bold'  => true,							                'color' => array('rgb' => 'FFFFFF'),							                'name'	=> 'Arial Narrow',	               						 'size'  => 8)	                );	                	//CELLS TO DISPLAY BROADCAST WEEKS	$proposalWeekCols = "U,V,W,X,Y,Z,AA,AB,AC,AD,AE,AF,AG,AH,AI,AJ,AK,AL,AM,AN,AO,AP,AQ,AR,AS,AT,AU,AV,AW,AX,AY,AZ,BA,BB,BC,BD,BE,BF,BG,BH,BI,BJ,BK,BL,BM,BN,BO,BP,BQ,BR,BS,BT,BU,BV,BW,BX,BY,BZ,CA,CB,CC,CD,CE,CF,CG,CH,CI,CJ,CK,CL,CM,CN,CO,CP,CQ,CR,CS,CT,CU,CV,CW,CX,CY,CZ,DA,DB,DC,DD,DE,DF,DG,DH,DI,DJ,DK,DL,DM,DN,DO,DP,DQ,DR,DS,DT,DU,DV,DW,DX,DY,DZ";	$xlsCols = explode(',',$proposalWeekCols);	                	// decode proposal data	$proposalLines = json_decode($json_data,true);	//CORPORATION ID	$corporation_id = $proposalLines['corporation'][0]['id'];	// decoding proposal array	$arrProposal = $proposalLines['proposal'];	// decoding corporation array	$arrCorp			= $proposalLines['corporation'];	// decode weeks array	$arrWeeks = array();	$arrWeeks = $proposalLines['weeks'];	// create PHPExcel object	$objExcel = new PHPExcel();	// Set document properities	$objExcel->getProperties()->setCreator("Service Report")   		     	->setLastModifiedBy("VAST Showseeker")        			->setTitle("ShowSeeker")		         ->setSubject("Report")        			->setDescription("Excel Report")        			->setKeywords("Office 5 Excel");	// page settings		$sheet = $objExcel->getActiveSheet();			//ORIENTATION AND SIZE	$sheet->getPageSetup()->setOrientation(PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE);	$sheet->getPageSetup()->setPaperSize(PHPExcel_Worksheet_PageSetup::PAPERSIZE_LETTER);	$sheet->getPageSetup()->setRowsToRepeatAtTopByStartAndEnd(1, 7);		//MARGINS	$pageMargins = $sheet->getPageMargins();	$margin = 0.6 / 2.54;		$pageMargins->setTop($margin);	$pageMargins->setBottom($margin);	$pageMargins->setLeft($margin);	$pageMargins->setRight($margin);	//SETTING UP PAGE NUBERS	$objExcel->getActiveSheet()->getHeaderFooter()->setOddFooter('Page &P / &N');	$objExcel->getActiveSheet()->getHeaderFooter()->setEvenFooter('Page &P / &N');	$objExcel->getActiveSheet()->getColumnDimension('A')->setWidth(3);	$objExcel->getActiveSheet()->getColumnDimension('B')->setWidth(7);	$objExcel->getActiveSheet()->getColumnDimension('C')->setWidth(8.5);	$objExcel->getActiveSheet()->getColumnDimension('D')->setWidth(8.5);	$objExcel->getActiveSheet()->getColumnDimension('E')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('F')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('G')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('H')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('I')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('J')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('K')->setWidth(2);	$objExcel->getActiveSheet()->getColumnDimension('L')->setWidth(7);		$objExcel->getActiveSheet()->getColumnDimension('M')->setWidth(5.5);	$objExcel->getActiveSheet()->getColumnDimension('N')->setWidth(4.5);	$objExcel->getActiveSheet()->getColumnDimension('O')->setWidth(4.5);		$objExcel->getActiveSheet()->getColumnDimension('P')->setWidth(4);	$objExcel->getActiveSheet()->getColumnDimension('Q')->setWidth(4.5);		$objExcel->getActiveSheet()->getColumnDimension('R')->setWidth(6);	$objExcel->getActiveSheet()->getColumnDimension('S')->setWidth(5);	$objExcel->getActiveSheet()->getColumnDimension('T')->setWidth(7);	$objExcel->getActiveSheet()->getColumnDimension('U')->setWidth(4);	$objExcel->getActiveSheet()->getColumnDimension('V')->setWidth(4);	$objExcel->getActiveSheet()->getColumnDimension('X')->setWidth(4);	$objExcel->getActiveSheet()->getColumnDimension('Y')->setWidth(4);	$objExcel->getActiveSheet()->getColumnDimension('Z')->setWidth(4);				$objExcel->getActiveSheet()->getColumnDimension('AA')->setWidth(4);				$objExcel->getActiveSheet()->getColumnDimension('AB')->setWidth(4);						// Set active sheet index to the first sheet	$objExcel->setActiveSheetIndex(0);	$objExcel->getActiveSheet()->getStyle('A1:AZ6')->applyFromArray(array('font'  => array('name'=>'Arial','size' => 8)));   $objExcel->getActiveSheet()->getStyle('A1:AZ6')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);	//PROPOSAL NAME	$proposalinfo = trim($proposalLines['proposalinfo']['name']);	// HEADER SECTION		// First Row  	$objRichText = new PHPExcel_RichText();  	  	$objCellProposalName = $objRichText->createTextRun($proposalinfo);  	$objCellProposalName->getFont()->setName('Arial')->setSize(8)->setBold(true);	$objExcel->getActiveSheet()->mergeCells('A1:K1');	$objExcel->getActiveSheet()->setCellValue('A1',$objRichText);		//FLIGHT DATES  	$objRichText = new PHPExcel_RichText();  	  			$objExcel->getActiveSheet()->mergeCells('L1:N1');  	$objCellFlightLabel = $objRichText->createTextRun('Flight Dates');  	$objCellFlightLabel->getFont()->setName('Arial')->setSize(8)->setBold(true);	$objExcel->getActiveSheet()->setCellValue('L1',$objRichText);  	  	  	// FLIGHT START DATE LABEL  	$objRichText = new PHPExcel_RichText();  	  	$objCellFlightStart = $objRichText->createTextRun("Start");  	$objCellFlightStart->getFont()->setName('Arial')->setSize(8)->setItalic(true)->setBold(true);  	$objExcel->getActiveSheet()->setCellValue('O1', $objRichText);	$objExcel->getActiveSheet()->mergeCells('P1:Q1');	  	// FLIGHT START DATE   	$objRichText = new PHPExcel_RichText();   $objCellFlightStartValue = $objRichText->createTextRun(date('n/j/y',strtotime($proposalLines['proposalinfo']['startdate'])));   $objCellFlightStartValue->getFont()->setName('Arial')->setSize(8);		$objExcel->getActiveSheet()->setCellValue('P1',$objRichText);  	// FLIGHT END DATE LABEL  	$objRichText = new PHPExcel_RichText();  	$objCellFlightEnd = $objRichText->createTextRun("End");  	$objCellFlightEnd->getFont()->setName('Arial')->setSize(8)->setItalic(true)->setBold(true);  	$objExcel->getActiveSheet()->setCellValue('S1', $objRichText);  	  	// FLIGHT END DATE   	  	$objRichText = new PHPExcel_RichText();  	$objCellFlightEndValue = $objRichText->createTextRun(date('n/j/y',strtotime($proposalLines['proposalinfo']['enddate'])));  	$objCellFlightEndValue->getFont()->setName('Arial')->setSize(8);  	$objExcel->getActiveSheet()->setCellValue('T1', $objRichText);		//CORPORATION NAME  	$objRichText = new PHPExcel_RichText();  	$objCellCorp = $objRichText->createTextRun($proposalLines['corporation'][0]['name']);  	$objCellCorp->getFont()->setName('Arial')->setSize(8)->setBold(true)->setItalic(true);	$objExcel->getActiveSheet()->mergeCells('U1:AB1');	$objExcel->getActiveSheet()->setCellValue('U1', $objRichText);	$objExcel->getActiveSheet()->getStyle('U1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);	// Second Row	$objExcel->getActiveSheet()->getStyle('A2:AB2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);	$objExcel->getActiveSheet()->getStyle('A2:AB2')->applyFromArray(array('font'  => array('bold'  => true)));		$objExcel->getActiveSheet()->mergeCells('A2:K2');	$objExcel->getActiveSheet()->setCellValue('A2','Order');	$objExcel->getActiveSheet()->mergeCells('L2:T2');	$objExcel->getActiveSheet()->setCellValue('L2','Billing');	$objExcel->getActiveSheet()->mergeCells('U2:AB2');	$objExcel->getActiveSheet()->setCellValue('U2','Totals');			// Third Row	$objExcel->getActiveSheet()->mergeCells('A3:B3');	$objExcel->getActiveSheet()->setCellValue('A3','AE');	$objExcel->getActiveSheet()->mergeCells('C3:K3');	$objExcel->getActiveSheet()->setCellValue('C3',$proposalLines['user'][0]['firstname'].' '.$proposalLines['user'][0]['lastname']);	$objExcel->getActiveSheet()->setCellValue('L3','Address');			$objExcel->getActiveSheet()->mergeCells('M3:T3');	$objExcel->getActiveSheet()->mergeCells('U3:V3');	$objExcel->getActiveSheet()->setCellValue('U3','Total Spots');	//TOTAL SPOTS IN THE PROPOSAL	$objExcel->getActiveSheet()->mergeCells('W3:X3');	$objExcel->getActiveSheet()->setCellValue('W3',$proposalLines['totals']['spots']);			$objExcel->getActiveSheet()->mergeCells('Y3:Z3');	$objExcel->getActiveSheet()->setCellValue('Y3','Gross $');	$objExcel->getActiveSheet()->mergeCells('AA3:AB3');	$objExcel->getActiveSheet()->setCellValue('AA3','=Dollar('.$proposalLines['totals']['gross'].')');			// Fourth Row	$objExcel->getActiveSheet()->mergeCells('A4:B4');	$objExcel->getActiveSheet()->setCellValue('A4','Agency');	$objExcel->getActiveSheet()->mergeCells('C4:K4');	$objExcel->getActiveSheet()->setCellValue('L4','City');	$objExcel->getActiveSheet()->mergeCells('M4:P4');	$objExcel->getActiveSheet()->setCellValue('Q4','State');	$objExcel->getActiveSheet()->setCellValue('S4','Zip');	$objExcel->getActiveSheet()->mergeCells('U4:V4');	$objExcel->getActiveSheet()->setCellValue('U4','Commission');	$objExcel->getActiveSheet()->mergeCells('W4:X4');	$objExcel->getActiveSheet()->mergeCells('Y4:Z4');	$objExcel->getActiveSheet()->mergeCells('AA4:AB4');			// Fifth Row	$objExcel->getActiveSheet()->mergeCells('A5:B5');	$objExcel->getActiveSheet()->setCellValue('A5','Client');	$objExcel->getActiveSheet()->mergeCells('C5:K5');	$objExcel->getActiveSheet()->setCellValue('L5','Contact');	$objExcel->getActiveSheet()->mergeCells('M5:P5');	$objExcel->getActiveSheet()->setCellValue('Q5','Phone');	$objExcel->getActiveSheet()->mergeCells('R5:T5');	$objExcel->getActiveSheet()->mergeCells('U5:V5');	$objExcel->getActiveSheet()->mergeCells('W5:X5');	$objExcel->getActiveSheet()->mergeCells('Y5:Z5');	$objExcel->getActiveSheet()->mergeCells('AA5:AB5');			// Sixth Row	$objExcel->getActiveSheet()->mergeCells('A6:B6');	$objExcel->getActiveSheet()->setCellValue('A6','RepFirm');	$objExcel->getActiveSheet()->mergeCells('C6:K6');	$objExcel->getActiveSheet()->mergeCells('M6:P6');	$objExcel->getActiveSheet()->mergeCells('R6:T6');	$objExcel->getActiveSheet()->mergeCells('U6:V6');	$objExcel->getActiveSheet()->mergeCells('W6:X6');	$objExcel->getActiveSheet()->mergeCells('Y6:Z6');	$objExcel->getActiveSheet()->setCellValue('Y6','Net $');		$objExcel->getActiveSheet()->mergeCells('AA6:AB6');		$objExcel->getActiveSheet()->setCellValue('AA6','=Dollar('.$proposalLines['totals']['net'].')');			// Set headers of listing// Seventh Row/*for ($col = 65; $col <= 84; $col++) {    $objExcel->getActiveSheet()->getColumnDimension(chr($col))->setAutoSize(true);}*/	$objExcel->getActiveSheet()->getRowDimension(7)->setRowHeight(25);		$objExcel->getActiveSheet()->setCellValue('A7','#');	$objExcel->getActiveSheet()->setCellValue('B7','Network');	$objExcel->getActiveSheet()->mergeCells('C7:D7');	$objExcel->getActiveSheet()->setCellValue('C7','Show');	$objExcel->getActiveSheet()->setCellValue('E7','M');	$objExcel->getActiveSheet()->setCellValue('F7','T');	$objExcel->getActiveSheet()->setCellValue('G7','W');	$objExcel->getActiveSheet()->setCellValue('H7','Th');	$objExcel->getActiveSheet()->setCellValue('I7','F');	$objExcel->getActiveSheet()->setCellValue('J7','S');	$objExcel->getActiveSheet()->setCellValue('K7','S');	$objExcel->getActiveSheet()->setCellValue('L7','Start');	$objExcel->getActiveSheet()->setCellValue('M7','End');	$objExcel->getActiveSheet()->setCellValue('N7','From');	$objExcel->getActiveSheet()->setCellValue('O7','To');	$objExcel->getActiveSheet()->setCellValue('P7','Wks');	$objExcel->getActiveSheet()->setCellValue('Q7',"Spots\nWk");	$objExcel->getActiveSheet()->getStyle('Q7')->getAlignment()->setWrapText(true);	$objExcel->getActiveSheet()->getStyle('Q7')->applyFromArray(array('font'  => array('size'  => 7)));	$objExcel->getActiveSheet()->setCellValue('R7',"Rate");	$objExcel->getActiveSheet()->setCellValue('S7',"Total\nSpots");	$objExcel->getActiveSheet()->getStyle('S7')->getAlignment()->setWrapText(true);	$objExcel->getActiveSheet()->getStyle('S7')->applyFromArray(array('font'  => array('size'  => 7)));	$objExcel->getActiveSheet()->setCellValue('T7',"Total\nAmount ");	$objExcel->getActiveSheet()->getStyle('T7')->getAlignment()->setWrapText(true);	$objExcel->getActiveSheet()->getStyle('T7')->applyFromArray(array('font'  => array('size'  => 7)));// Set number of weeks listing heading	$w = 0;				//week counter   $lastcell = 'U7';   $lastcol  = '';	//CREATING HEADER OF BROADCAST WEEKS	foreach($arrWeeks as $key => $value) {		    $objExcel->getActiveSheet()->getColumnDimension($xlsCols[$w])->setWidth(5);		    $week = explode('/',$value['week']);		    $objExcel->getActiveSheet()->setCellValue($xlsCols[$w].'7',"W".($w+1)."\n".$week[0]." - ".$week[1]);	    	    $objExcel->getActiveSheet()->getStyle($xlsCols[$w].'7')->getAlignment()->setWrapText(true);		    $lastcell 		= $xlsCols[$w].'7';   	 $lastcolumn  	= $xlsCols[$w];   	    	    $w++;	}    if( count($arrWeeks) > 8 && count($arrWeeks) < 39){	  	$objExcel->getActiveSheet()->mergeCells($xlsCols[($w)].'7:BF7');	}	$objExcel->getActiveSheet()->getStyle('A7:'.$lastcell)->applyFromArray($styleHead2);	$objExcel->getActiveSheet()->getStyle('A7:'.$lastcell)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);	$objExcel->getActiveSheet()->getStyle('A7:'.$lastcell)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);	$objExcel->getActiveSheet()->getStyle('A7:'.$lastcell)->getFill()->applyFromArray(array('type' => PHPExcel_Style_Fill::FILL_SOLID,'startcolor' => array('rgb' => '000000')));   $objExcel->getActiveSheet()->getStyle('A7:'.$lastcell)->getBorders()->getAllBorders()->applyFromArray($styleCellBorders);	$objExcel->getActiveSheet()->getStyle('A1:AB6')->getBorders()->getAllBorders()->applyFromArray($styleCellBorders);	// FreezePane rows (Assign vertical scrolling from this column and row)	$objExcel->getActiveSheet()->freezePane('A8');	$i=1;	$row = 8;		$total_amount = 0;	$total_spots = 0;	$gross = 0;	$net = 0;	$arrTotalSpots = array();      // Contains total spots cells range of each zone	$arrFinalTotalCell = array();  // Contain $ Gross totals cells of each zone// Printing actual proposal dataforeach($arrProposal as $proposalKey => $proposalValue) {    $zone_amount = 0;    $arrWeeksTotal = array();    foreach($arrWeeks as $key => $value) {        $arrWeeksTotal[$value['week']] = 0;    }    // Zone name and sys code    $objExcel->getActiveSheet()->mergeCells('A'.$row.':K'.$row);    $zoneName = $proposalValue['zone']['zonename'];    $sysCode = isset($proposalValue['zone']['syscode']) ? $proposalValue['zone']['syscode'] : '';    $objExcel->getActiveSheet()->setCellValue('A'.$row,'Zone : '.$zoneName.'  SysCode : '.$sysCode);    $startDate = trim($proposalValue['lines'][0]['startdate']);    $row++;    $zone_row = $row;    foreach($proposalValue['lines'] as $zoneKey => $zoneValue){		  //callsign        $objExcel->getActiveSheet()->setCellValue('A'.$row,$i);        $objExcel->getActiveSheet()->setCellValue('B'.$row,trim($zoneValue['callsign']));		  //Show Title        $objExcel->getActiveSheet()->mergeCells('C'.$row.':D'.$row);        $objExcel->getActiveSheet()->setCellValue('C'.$row,trim($zoneValue['title']));        // display day wise cross (X) mark        $mon = '';        $tue = '';        $wed = '';        $thur = '';        $fri = '';        $sat = '';        $sun = '';        // If days value is in array format        if(is_array($zoneValue['day'])) {            $dayCount = count($zoneValue['day']);            for($j=0;$j<$dayCount;$j++) {                $day = $zoneValue['day'][$j];                if(trim($day)==1) {                    $sun = 'x';                }                if(trim($day)==2) {                    $mon = 'x';                }                if(trim($day)==3) {                    $tue = 'x';                }                if(trim($day)==4) {                    $wed = 'x';                }                if(trim($day)==5) {                    $thur = 'x';                }                if(trim($day)==6) {                    $fri = 'x';                }                if(trim($day)==7) {                    $sat = 'x';                }            }        }else {            // If days value is directly assign to day index            $day = $zoneValue['day'];            if(trim($day)==1) {                $sun = 'x';            }            if(trim($day)==2) {                $mon = 'x';            }            if(trim($day)==3) {                $tue = 'x';            }            if(trim($day)==4) {                $wed = 'x';            }            if(trim($day)==5) {                $thur = 'x';            }            if(trim($day)==6) {                $fri = 'x';            }            if(trim($day)==7) {                $sat = 'x';            }        }        $objExcel->getActiveSheet()->setCellValue('E'.$row,$mon);        $objExcel->getActiveSheet()->setCellValue('F'.$row,$tue);                $objExcel->getActiveSheet()->setCellValue('G'.$row,$wed);        $objExcel->getActiveSheet()->setCellValue('H'.$row,$thur);        $objExcel->getActiveSheet()->setCellValue('I'.$row,$fri);        $objExcel->getActiveSheet()->setCellValue('J'.$row,$sat);        $objExcel->getActiveSheet()->setCellValue('K'.$row,$sun);			//START DATE        $objExcel->getActiveSheet()->setCellValue('L'.$row,date ('n/j/y',strtotime($zoneValue['startdate'])));        $objExcel->getActiveSheet()->setCellValue('M'.$row,date ('n/j/y',strtotime($zoneValue['enddate'])));                $startTime = date('H:i',strtotime(trim($zoneValue['starttime'])));                $objExcel->getActiveSheet()->setCellValue('N'.$row,$startTime);        $endTime = date('H:i',strtotime(trim($zoneValue['endtime'])));        $objExcel->getActiveSheet()->setCellValue('O'.$row,$endTime);        $objExcel->getActiveSheet()->setCellValue('P'.$row,trim($zoneValue['weeks']));        $objExcel->getActiveSheet()->setCellValue('Q'.$row,trim($zoneValue['spotsweek']));					  //CENTERING 		  $objExcel->getActiveSheet()->getStyle('E'.$row.':Q'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);                		  //LINE RATE        $objExcel->getActiveSheet()->getStyle('R'.$row.':T'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);        $objExcel->getActiveSheet()->getStyle('R'.$row)->getNumberFormat()->setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);			// HACK TO FIX MALFORMMED RATES		  $thisrate = explode(".",$zoneValue['rate']);		  $linerate = $thisrate[0];		  if(count($thisrate)>1){$linerate = $linerate.$thisrate[1];}        $objExcel->getActiveSheet()->setCellValue('R'.$row,'=DOLLAR('.number_format($linerate,2).')');		  // LINE TOTAL SPOTS        $objExcel->getActiveSheet()->getStyle('S'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $objExcel->getActiveSheet()->setCellValue('S'.$row,trim($zoneValue['spots']));		  // LINE TOTAL COST        $total_spots = $total_spots + trim($zoneValue['spots']);        $objExcel->getActiveSheet()->getStyle('T'.$row)->getNumberFormat()->setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);        $objExcel->getActiveSheet()->setCellValue('T'.$row,'=Dollar(R'.$row.' * SUM(U'.$row.':DZ'.$row.'))');        $zone_amount += trim($zoneValue['total']);        $total_amount += trim($zoneValue['total']);			$w =	0;                        foreach($arrWeeks as $key => $value) {            $week = str_replace('/','',$value['week']);            $objExcel->getActiveSheet()->getStyle($xlsCols[$w])->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);            if(isset($zoneValue['w'.$week])) {                $arrWeeksTotal[$value['week']] += $zoneValue['w'.$week];                $objExcel->getActiveSheet()->setCellValue($xlsCols[$w].$row,$zoneValue['w'.$week]);            }else {                $arrWeeksTotal[$value['week']] += 0;                $objExcel->getActiveSheet()->setCellValue($xlsCols[$w].$row,'0');            }            $w++;        }        		 $objExcel->getActiveSheet()->getStyle('A'.$row.':'.$xlsCols[($w-1)].$row)->applyFromArray(array('font'  => array('size'  => 8, 'name'=>'Arial Narrow')));        $endDate = trim($zoneValue['enddate']);		  $objExcel->getActiveSheet()->getStyle('A'.$row.':'.$xlsCols[$w-1].$row.'')->getBorders()->getAllBorders()->applyFromArray($styleCellBorders);        $row++;   // row increment        $i++;     // record increment    }		  /*$objExcel->getActiveSheet()->getStyle('A1:' . 	 						$objExcel->getActiveSheet()->getHighestColumn() . 				    		$objExcel->getActiveSheet()->getHighestRow()							)->applyFromArray($styleArray);*/       // Printing zone wise total amount    $objExcel->getActiveSheet()->mergeCells('A'.$row.':S'.$row);    $objExcel->getActiveSheet()->getStyle('A'.$row.':S'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);    $objExcel->getActiveSheet()->setCellValue('A'.$row,trim($zoneName).' Totals');    $bg_width = 'T'.$row.':'.$lastcolumn.$row;    $objExcel->getActiveSheet()->getStyle($bg_width)->getBorders()->getBottom()->setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);    $objExcel->getActiveSheet()->getStyle($bg_width)->getFill()->applyFromArray(array('type' => PHPExcel_Style_Fill::FILL_SOLID,'startcolor' => array('rgb' => 'C0C0C0')));    $objExcel->getActiveSheet()->getStyle('T'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);    $objExcel->getActiveSheet()->getStyle('T'.$row)->getNumberFormat()->setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_CURRENCY_USD);    $objExcel->getActiveSheet()->setCellValue('T'.$row,'=SUM(T'.$zone_row.':T'.($row-1).')');        // Lock Total Amount column    $objExcel->getActiveSheet()->getStyle('T'.$zone_row.':T'.($row).'')->getProtection()->setLocked( PHPExcel_Style_Protection::PROTECTION_PROTECTED);    $arrFinalTotalCell[] = 'T'.$row;    $arrTotalSpots[] = 'S'.$zone_row.':S'.($row-1).'';    // Printing zone wise weeks total    $w = 0;    $column = $xlsCols[$w].$row;    $col1 = $xlsCols[$w].$zone_row;    $col2 = $xlsCols[$w].($row-1);        foreach($arrWeeksTotal as $key => $value) {        	$objExcel->getActiveSheet()->getStyle($column)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        	$objExcel->getActiveSheet()->setCellValue($column,'=SUM('.$col1.':'.$col2.')');         $w++;   	 	$col1 = $xlsCols[$w].$zone_row;	    	$col2 = $xlsCols[$w].($row-1);         		   $column = $xlsCols[$w].$row;    }     $objExcel->getActiveSheet()->getStyle('A'.$row.':'.$lastcolumn.$row)->getFont()->setName('Arial Narrow')->setSize(8)->setBold(true);    $row += 2;}/*// Set start and end date at the top$objExcel->getActiveSheet()->mergeCells('P1:Q1');$objExcel->getActiveSheet()->getStyle('P1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);$objExcel->getActiveSheet()->setCellValue('P1',$startDate);$objExcel->getActiveSheet()->mergeCells('T1:U1');$objExcel->getActiveSheet()->getStyle('T1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);$objExcel->getActiveSheet()->setCellValue('T1',$endDate);//Total Spots$objExcel->getActiveSheet()->getStyle('W3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);//$objExcel->getActiveSheet()->setCellValue('W3',$total_spots);$objExcel->getActiveSheet()->setCellValue('W3','=SUM('.implode(',',$arrTotalSpots).')');// Gross $$objExcel->getActiveSheet()->mergeCells('AA3:AB3');$objExcel->getActiveSheet()->getStyle('AA3')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);//$objExcel->getActiveSheet()->setCellValue('AA3','$'.number_format(trim($proposalLines['totals']['gross']),2));$objExcel->getActiveSheet()->setCellValue('AA3','=DOLLAR(SUM('.implode(',',$arrFinalTotalCell).'))');//Net $$objExcel->getActiveSheet()->mergeCells('AA6:AB6');$objExcel->getActiveSheet()->getStyle('AA6')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);//$objExcel->getActiveSheet()->setCellValue('AA6','$'.number_format(trim($proposalLines['totals']['gross']),2));$objExcel->getActiveSheet()->setCellValue('AA6','=DOLLAR(AA3-AA4-AA5)');*/// Second Table Month Wise information$monthTotals = $proposalLines['brodmonthstotal'];$rowNo = $row+3;$objExcel->getActiveSheet()->getStyle('A'.$rowNo.':'.'B'.$rowNo)->getFill()->applyFromArray(array('type' => PHPExcel_Style_Fill::FILL_SOLID,'startcolor' => array('rgb' => 'C0C0C0')));$objExcel->getActiveSheet()->getStyle('A'.$rowNo.':'.'A'.($rowNo+4))->applyFromArray(array('font'  => array('bold'  => true)));$objExcel->getActiveSheet()->mergeCells('A'.$rowNo.':'.'B'.$rowNo);$objExcel->getActiveSheet()->getStyle('A'.$rowNo)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);$objExcel->getActiveSheet()->setCellValue('A'.$rowNo,'Totals');$rowNo1 = $rowNo + 1;$objExcel->getActiveSheet()->mergeCells('A'.$rowNo1.':'.'B'.$rowNo1);$objExcel->getActiveSheet()->getStyle('A'.$rowNo1)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);$objExcel->getActiveSheet()->setCellValue('A'.$rowNo1,'Spots');$rowNo2 = $rowNo1 + 1;$objExcel->getActiveSheet()->mergeCells('A'.$rowNo2.':'.'B'.$rowNo2);$objExcel->getActiveSheet()->getStyle('A'.$rowNo2)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);$objExcel->getActiveSheet()->setCellValue('A'.$rowNo2,'Gross $');$rowNo3 = $rowNo2 + 1;$objExcel->getActiveSheet()->mergeCells('A'.$rowNo3.':'.'B'.$rowNo3);$objExcel->getActiveSheet()->getStyle('A'.$rowNo3)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);$objExcel->getActiveSheet()->setCellValue('A'.$rowNo3,'Net $');$objExcel->getActiveSheet()->getStyle('A'.$rowNo.':'.$lastcolumn.$rowNo3)->getFont()->setName('Arial Narrow')->setSize(8);foreach($monthTotals as $yearKey => $yearVal){    $char_ascii = 67;    $year = substr($yearKey,2,2);    foreach($yearVal as $monthKey => $monthVal){        $i=$rowNo;        if($char_ascii==69){  // Merging columns(E,F,G,H,I,J)            $char_ascii1 = $char_ascii + 5;            for($j=$rowNo;$j<=$rowNo3;$j++){                $objExcel->getActiveSheet()->mergeCells(chr($char_ascii).$j.':'.chr($char_ascii1).$j);            }        }else if($char_ascii==74){     //// Merging columns(K,L)            $char_ascii++;            $char_ascii1 = $char_ascii + 1;            for($j=$rowNo;$j<=$rowNo3;$j++){                $objExcel->getActiveSheet()->mergeCells(chr($char_ascii).$j.':'.chr($char_ascii1).$j);            }        }        $column_row =  chr($char_ascii).$i;        $objExcel->getActiveSheet()->getStyle($column_row)->getFill()->applyFromArray(array('type' => PHPExcel_Style_Fill::FILL_SOLID,'startcolor' => array('rgb' => 'C0C0C0')));        $objExcel->getActiveSheet()->getStyle($column_row)->applyFromArray(array('font'  => array('bold'  => true)));        $objExcel->getActiveSheet()->getStyle($column_row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $objExcel->getActiveSheet()->setCellValue($column_row,$monthVal['monthabr'].'-'.$year);        $i++;        $column_row =  chr($char_ascii).$i;        $objExcel->getActiveSheet()->getStyle($column_row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);        $objExcel->getActiveSheet()->setCellValue($column_row,$monthVal['spotsmonth']);        $i++;        $column_row =  chr($char_ascii).$i;        $objExcel->getActiveSheet()->getStyle($column_row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);        $objExcel->getActiveSheet()->setCellValue($column_row,'$'.number_format(trim($monthVal['monthtotal']),2));        $i++;        $column_row =  chr($char_ascii).$i;        $objExcel->getActiveSheet()->getStyle($column_row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);        $objExcel->getActiveSheet()->setCellValue($column_row,'$'.number_format(trim($monthVal['nettotal']),2));        if($char_ascii==69){            $char_ascii = $char_ascii + 5;        }else if($char_ascii==75){            $char_ascii++;            $char_ascii = $char_ascii + 1;        }else{            $char_ascii++;        }    }     }$rowNo = $rowNo+3;if($includetc == 'true' && $corporation_id == 25){	include_once('xls/terms/midhudson.php');	if($showratecard == 'false' && $hiderate == 'false'){		termsandconditions($objExcel,$rowNo,'AB');	}	elseif($hiderate == 'true'){	termsandconditions($objExcel,$rowNo,'Z');	}	elseif($showratecard == 'true' && $hiderate == 'false'){	termsandconditions($objExcel,$rowNo,'AC');	}}// Create and Save file$objWriter = PHPExcel_IOFactory::createWriter($objExcel, 'Excel5');$pslFileName = cleanStr($proposalinfo);$objWriter->save('/var/www/html/showseeker/files/tmp/'.$pslFileName.'.xls');echo '{"filename":"'.$pslFileName.'.xls"}';exit;function cleanStr($string) {   $string = str_replace(' ', '_', $string); // Replaces all spaces with hyphens.   return preg_replace('/[^A-Za-z0-9\-]/', '', $string); // Removes special chars.}?>