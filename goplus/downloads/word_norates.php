<?phpini_set('display_errors',1);ini_set('max_execution_time','0');// phpWord Classesrequire_once 'Classes/PHPWord.php';//GETTING PROPOSAL DATArequire_once 'service_data.php';// json decode proposal data$proposalLines = json_decode($json_data,true);// passed proposal data to array variable$arrProposal 	= $proposalLines['proposal'];$proposalinfo = trim($proposalLines['proposalinfo']['name']);// New Word Document$objWord = new PHPWord();// New portrait section$section = $objWord->createSection(array('marginLeft'=>600, 'marginRight'=>600, 'marginTop'=>600, 'marginBottom'=>600, 'pageSizeW'=>12240, 'pageSizeH'=>15840));$bordeinferior = array('borderBottomColor' => 'D2D2D2','borderBottomSize' => 20);$styleFirstRow = array();$styleTable = array();$objWord->addTableStyle('myTable', $styleTable, $bordeinferior);$objWord->addFontStyle('fStyle', array('bold'=>true, 'size'=>10));$objWord->addParagraphStyle('pStyle', array('align'=>'center', 'spaceAfter'=>0));//Create Table$table = $section->addTable('doc_report');// Listing Headings$table->addRow(400,"exact");$cellHeadingStyle = array('bgColor'=>'333333','valign'=>'center');$objWord->addFontStyle('headFontStyle', array('bold'=>true,'name' => 'Verdana', 'size'=>10,'color'=>'FFFFFF'));$objWord->addParagraphStyle('headPrStyle', array('align'=>'center','spaceAfter' => 0));//HEADER BAR$table->addCell(2000,$cellHeadingStyle)->addText("Network","headFontStyle","headPrStyle");$table->addCell(8000,$cellHeadingStyle)->addText("Show","headFontStyle","headPrStyle");$table->addCell(2000,$cellHeadingStyle)->addText("Date","headFontStyle","headPrStyle");$table->addCell(2000,$cellHeadingStyle)->addText("Time","headFontStyle","headPrStyle");// Printing actual proposal data (Zone wise)foreach($arrProposal as $proposalKey => $proposalValue) {    $zoneName = isset($proposalValue['zone']['zonename']) ? $proposalValue['zone']['zonename'] : '';    $table->addRow(600,"exact");    $cellStyle4=array('gridSpan' => 4,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor'=>'CCCCCC');	//ZONE NAME    $table->addCell(14000,$cellStyle4)->addText("Zone : ".$zoneName,array('bold'=>true,'name' => 'Verdana', 'size'=>9),array('align'=>'right','spaceAfter' => 0));    $zone_total_spot = 0;    $zone_total = 0;	// GETTING LOGO INFO    foreach($proposalValue['lines'] as $zoneKey => $zoneValue){	     	     $logo= '';                $table->addRow(1200,null);        $cellStyle = array('valign'=>'center','borderBottomSize'=>3,'borderBottomColor'=>'CCCCCC');                $objWord->addFontStyle('cellFontStyle', array('name' => 'Verdana', 'size'=>8,'color'=>'000000'));        $objWord->addFontStyle('cellFontStyle1', array('bold'=>true,'name' => 'Verdana', 'size'=>10,'color'=>'000000'));        $objWord->addFontStyle('cellFontStyle2', array('bold'=>true,'name' => 'Verdana', 'size'=>8,'color'=>'000000'));        $objWord->addFontStyle('cellFontStyle3', array('bold'=>true,'name' => 'Verdana', 'size'=>10,'color'=>'FF0000'));                $objWord->addParagraphStyle('cellPrStyle', array('align'=>'center','spaceAfter' => 0));        $objWord->addParagraphStyle('cellCallsignStyle', array('align'=>'center','spaceAfter' => 0,'bold'=>true));                $objWord->addParagraphStyle('cellPrStyle1', array('align'=>'left','spaceAfter' => 0));                //STATION LOGO OR CALLSIGN         if($includelogos != 'false'){	        if(isset($proposalLines['networks'])){	            foreach($proposalLines['networks'] as $network){	                if(trim($network['stationnum'])==$zoneValue['stationnum']){	                    $logo = trim($network['100x100']);	                    $imgPath = str_replace('/services/downloads','',getcwd());	                    $logo = str_replace('http://ww2.showseeker.com',$imgPath.'/showseeker', $logo);	                }	            }	        }   	     $table->addCell(1500,$cellStyle)->addImage($logo, array('width'=>50, 'height'=>50, 'align'=>'center'),array('align'=>'center','spaceAfter' => 0));			}			else{	        $table->addCell(1500,$cellStyle)->addText($zoneValue['callsign'],"cellFontStyle2", "cellCallsignStyle");						}		  //FORMATING SHOW TITLE   	  $title = $zoneValue['title'];        		  $thesetitles = explode(',',$title);	     if(count($thesetitles) > 5){				$title = $thesetitles[0].', '.$thesetitles[1].', '.$thesetitles[2].', '.$thesetitles[3].', '.$thesetitles[4].', more…';		  } 			  $showInfo = $table->addCell(8500,$cellStyle);			if($zoneValue['premiere'] == 'Premiere'){				$premieres = 	"Movie Premiere";			}			else{				$premieres = 	$zoneValue['premiere'];						}			$textrun = $showInfo->createTextRun();			// PROGRAM TITLE			if($premieres == ''){				$textrun->addText(rtrim($title,', '),"cellFontStyle1","cellPrStyle1");			}			else{				$textrun->addText(rtrim($title,', '),"cellFontStyle3","cellPrStyle1");			}						//FIXED POSITION LINES DETAILS						if($zoneValue['linetype'] == 'Fixed'){							$textrun = $showInfo->createTextRun();					//GENRE				$textrun->addText($zoneValue['genre'],array('name' => 'Verdana', 'size'=>8, 'italic'=>true));								//STARS RATING				$textrun->addText(' '.$zoneValue['stars'],array('name' => 'Verdana', 'size'=>8, 'italic'=>true));									//PREMIERES IDENTIFIER				$textrun->addText(' '.$premieres, array('name' => 'Verdana', 'size'=>8, 'italic'=>true));					//NEW IDENTIFIER							if($zoneValue['isnew'] != '' && $premieres == '' && $includenew != 'false'){					$textrun->addText('New', array('name' => 'Verdana', 'size'=>8, 'color'=>'green', 'bold'=>true, 'italic'=> true));				}										//EPISODE				if($zoneValue['linetype'] == 'Fixed' && $zoneValue['epititle'] != ''){										$textrun = $showInfo->createTextRun();					$textrun->addText($zoneValue['epititle'],array('name' => 'Verdana', 'size'=>8, 'color'=>'blue', 'italic'=>true));				}								// DESCRIPTION									if($includedesc && $zoneValue['desc60'] != '' && $includedesc != 'false'){					$textrun = $showInfo->createTextRun();					$textrun->addText($zoneValue['desc60'],array('name' => 'Verdana', 'size'=>8));					}			}									        $days = isset($zoneValue['dayFormat']) ? $zoneValue['dayFormat'] : '';        $startDate = explode('/',$zoneValue['startdate']);        $endDate = explode('/',$zoneValue['enddate']);                $thiscell = $table->addCell(2000,$cellStyle);                $date = trim($days);        $thiscell->addText($date,"cellFontStyle","cellPrStyle");        $date = $startDate[0].'-'.$startDate[1].'-'.substr($startDate[2],2,2);        $thiscell->addText($date,"cellFontStyle","cellPrStyle");        $date = ' to ';        $thiscell->addText($date,"cellFontStyle","cellPrStyle");        $date = $endDate[0].'-'.$endDate[1].'-'.substr($endDate[2],2,2);        $thiscell->addText($date,"cellFontStyle","cellPrStyle");        $thiscell = $table->addCell(2000,$cellStyle);        $time =  str_replace(':00','',date ('g:iA',strtotime($zoneValue['starttime'])));        $thiscell->addText($time,"cellFontStyle","cellPrStyle");                $time = ' to ';                $thiscell->addText($time,"cellFontStyle", "cellPrStyle");        $time = str_replace(':00','',date ('g:iA',strtotime($zoneValue['endtime'])));                $thiscell->addText($time,"cellFontStyle", "cellPrStyle");    }}// Save File$objWriter = PHPWord_IOFactory::createWriter($objWord, 'Word2007');$pslFileName = cleanStr($proposalinfo);$objWriter->save('/var/www/html/showseeker/files/tmp/'.$pslFileName.'.docx');echo '{"filename":"'.$pslFileName.'.docx"}';exit;function cleanStr($string) {   $string = str_replace(' ', '_', $string); // Replaces all spaces with hyphens.   return preg_replace('/[^A-Za-z0-9\-]/', '', $string); // Removes special chars.}// Download fileecho $file = $excelLocation.'word_report2_'.$_GET['proposalid'].'.docx';if (file_exists($file)) {    header('Content-Description: File Transfer');    header('Content-Type: application/octet-stream');    header('Content-Disposition: attachment; filename='.basename($file));    header('Content-Transfer-Encoding: binary');    header('Expires: 0');    header('Cache-Control: must-revalidate');    header('Pragma: public');    header('Content-Length: ' . filesize($file));    ob_clean();    flush();    readfile($file);    exit;}?>