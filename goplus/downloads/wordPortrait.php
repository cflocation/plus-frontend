<?phpini_set('display_errors',1);ini_set('max_execution_time','0');require_once 'Classes/PHPWord.php';//Getting variable values$proposalid	= urldecode(trim($_GET['proposalid']));$userid		= urldecode(trim($_GET['userid']));$tokenid	= urldecode(trim($_GET['tokenid']));//Fetching data in json format$json_data	= file_get_contents("http://services.showseeker.com/proposal.php?proposalid={$proposalid}&userid={$userid}&tokenid={$tokenid}");// json decode proposal data$proposalLines = json_decode($json_data,true);// passed proposal data to array variable$arrProposal = $proposalLines['proposal'];// New Word Document$objWord = new PHPWord();// New portrait section$section = $objWord->createSection(array('marginLeft'=>300, 'marginRight'=>300, 'marginTop'=>300, 'marginBottom'=>300, 'pageSizeW'=>11300, 'pageSizeH'=>20000));if(isset($proposalLines['corporation'])){    $corporation = trim($proposalLines['corporation'][0]['name']);    $logo = trim($proposalLines['corporation'][0]['logo']);    $imgPath = str_replace('/services/downloads','',getcwd());    $logo = str_replace('http://ww2.showseeker.com',$imgPath.'/showseeker', $logo);}else{    $corporation = '';    $logo = '';}//$styleTable = array('borderColor'=>'C2C2C2',//			  'borderSize'=>10);//$styleFirstRow = array('bgColor'=>'66BBFF');$bordeinferior = array('borderBottomColor' => 'D2D2D2','borderBottomSize' => 20);$styleFirstRow = array();$styleTable = array();$objWord->addTableStyle('myTable', $styleTable, $bordeinferior);$objWord->addFontStyle('fStyle', array('size'=>9, 'name' => 'Verdana'));$objWord->addFontStyle('fStyleUser', array('size'=>9, 'name' => 'Verdana', 'italic'=>true));$objWord->addFontStyle('fStyleCompany', array('size'=>14, 'name' => 'Verdana'));$objWord->addParagraphStyle('pStyle', array('align'=>'center', 'spaceAfter'=>0));//Create Table$table = $section->addTable('doc_report');//Header Image and User details$table->addRow(1100);$cellStyle1=array('gridSpan' => 3,'valign'=>'center','borderBottomColor' => '000000','borderBottomSize' => 20);$table->addCell(7000,$cellStyle1)->addImage($logo, array('width'=>170, 'height'=>80, 'align'=>'left'));$cellStyle2=array('gridSpan' => 7,'valign'=>'center','borderBottomColor' => '000000','borderBottomSize' => 20);$userinfocell = $table->addCell(7000,$cellStyle2);if(isset($proposalLines['user'])){	 $userinfocell->addText($corporation,"fStyleCompany","pStyle");    $user_name = $proposalLines['user'][0]['firstname'].' '.$proposalLines['user'][0]['lastname'];	 $userinfocell->addText($user_name,"fStyleUser","pStyle");    $user_off_address = isset($proposalLines['user'][0]['officeaddress']) ? $proposalLines['user'][0]['officeaddress'] : '';	 $userinfocell->addText($user_off_address,"fStyle","pStyle");          $user_state = isset($proposalLines['user'][0]['officestate']) ? ' '.$proposalLines['user'][0]['officestate'] : '';    $user_city = isset($proposalLines['user'][0]['officecity']) ? $proposalLines['user'][0]['officecity'] : '';    $user_zip = isset($proposalLines['user'][0]['officezipcode']) ? $proposalLines['user'][0]['officezipcode'] : '';        $userinfocell->addText($user_city.', '.$user_state.', '.$user_zip,"fStyle","pStyle");           $user_phone = isset($proposalLines['user'][0]['phone']) ? $proposalLines['user'][0]['phone'] : '';    $userinfocell->addText($user_phone,"fStyle","pStyle");   }// Prpposal Nameif(isset($proposalLines['proposalinfo']) && !empty($proposalLines['proposalinfo'])){    $table->addRow(400,"exact");    $cellStyle2=array('gridSpan' => 10,'valign'=>'center');    $table->addCell(14000,$cellStyle2)->addText($proposalLines['proposalinfo']['name'], array('bold'=>true, 'size'=>12),"pStyle");}// Listing Headings$table->addRow(420,"exact");$cellHeadingStyle = array('bgColor'=>'333333','valign'=>'center');$objWord->addFontStyle('headFontStyle', array('bold'=>true,'name' => 'Calibri', 'size'=>9,'color'=>'FFFFFF'));$objWord->addFontStyle('headFontStyle1', array('bold'=>true,'name' => 'Calibri', 'size'=>8,'color'=>'FFFFFF'));$objWord->addParagraphStyle('headPrStyle', array('align'=>'center','spaceAfter' => 0));$table->addCell(1400,$cellHeadingStyle)->addText("Network","headFontStyle","headPrStyle");$table->addCell(1600,$cellHeadingStyle)->addText("DayPart","headFontStyle","headPrStyle");$table->addCell(4000,$cellHeadingStyle)->addText("Show","headFontStyle","headPrStyle");$table->addCell(1500,$cellHeadingStyle)->addText("Start","headFontStyle","headPrStyle");$table->addCell(1500,$cellHeadingStyle)->addText("End","headFontStyle","headPrStyle");$table->addCell(800,$cellHeadingStyle)->addText("Wks","headFontStyle","headPrStyle");$table->addCell(800,$cellHeadingStyle)->addText("Spots Wk","headFontStyle1","headPrStyle");$table->addCell(800,$cellHeadingStyle)->addText("Rate","headFontStyle","headPrStyle");$table->addCell(800,$cellHeadingStyle)->addText("Total Spots","headFontStyle1","headPrStyle");$table->addCell(800,$cellHeadingStyle)->addText("Total","headFontStyle","headPrStyle");// Printing actual proposal data (Zone wise)foreach($arrProposal as $proposalKey => $proposalValue) {    $zoneName = isset($proposalValue['zone']['zonename']) ? $proposalValue['zone']['zonename'] : '';    $table->addRow(400,"exact");    $cellStyle4=array('gridSpan' => 10,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');    $table->addCell(14000,$cellStyle4)->addText("Zone : ".$zoneName,array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right','spaceAfter' => 0));    $zone_total_spot = 0;    $zone_total = 0;    foreach($proposalValue['lines'] as $zoneKey => $zoneValue){        $logo= '';        if(isset($proposalLines['networks'])){            foreach($proposalLines['networks'] as $network){                if(trim($network['stationnum'])==$zoneValue['stationnum']){                    $logo = trim($network['100x100']);                    $imgPath = str_replace('/services/downloads','',getcwd());                    $logo = str_replace('http://ww2.showseeker.com',$imgPath.'/showseeker', $logo);                }            }        }        $table->addRow(100,null);        $cellStyle = array('valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');        $objWord->addFontStyle('cellFontStyle', array('name' => 'Calibri', 'size'=>9,'color'=>'000000'));        $objWord->addFontStyle('cellFontStyle1', array('bold'=>true,'name' => 'Calibri', 'size'=>8,'color'=>'000000'));        $objWord->addParagraphStyle('cellPrStyle', array('align'=>'center','spaceAfter' => 0));        $objWord->addParagraphStyle('cellPrStyle1', array('align'=>'left','spaceAfter' => 0));        $table->addCell(1400,$cellStyle)->addImage($logo, array('width'=>50, 'height'=>50, 'align'=>'left'),array('align'=>'center','spaceAfter' => 0));        $days = isset($zoneValue['dayFormat']) ? $zoneValue['dayFormat'] : '';        $dayPart = trim($days).' '.date('H:i A',strtotime($zoneValue['starttime'])).'-'.date('H:i A',strtotime($zoneValue['endtime']));        $table->addCell(1600,$cellStyle)->addText($dayPart,"cellFontStyle","cellPrStyle1");        $titleFormat = isset($zoneValue['titleFormat']) ? str_replace('|',' ',$zoneValue['titleFormat']) : '';        $table->addCell(4000,$cellStyle)->addText($titleFormat,"cellFontStyle1","cellPrStyle1");        $startTime = explode('/',$zoneValue['startdate']);        $table->addCell(1500,$cellStyle)->addText($startTime[0].'-'.$startTime[1].'-'.substr($startTime[2],2,2),"cellFontStyle","cellPrStyle1");        $endTime = explode('/',$zoneValue['enddate']);        $table->addCell(1500,$cellStyle)->addText($endTime[0].'-'.$endTime[1].'-'.substr($endTime[2],2,2),"cellFontStyle","cellPrStyle1");        $table->addCell(800,$cellStyle)->addText($zoneValue['weeks'],"cellFontStyle","cellPrStyle");        $table->addCell(800,$cellStyle)->addText($zoneValue['spotsweek'],"cellFontStyle","cellPrStyle");        $table->addCell(800,$cellStyle)->addText($zoneValue['rate'],"cellFontStyle","cellPrStyle");        $zone_total_spot += (int)$zoneValue['spots'];        $table->addCell(800,$cellStyle)->addText($zoneValue['spots'],"cellFontStyle","cellPrStyle");        $total = trim($zoneValue['rate'])*trim($zoneValue['spots']);        $zone_total =  $zone_total + $total;        $table->addCell(800,$cellStyle)->addText($total,"cellFontStyle","cellPrStyle");    }    $table->addRow(250,"exact");    $cellStyle5=array('gridSpan' => 7,'valign'=>'center');    $table->addCell(11600,$cellStyle5)->addText('');    $cellStyle6=array('valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');    $table->addCell(800,$cellStyle6)->addText("Total ",array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center'));    $table->addCell(800,$cellStyle6)->addText($zone_total_spot,array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center'));    $table->addCell(800,$cellStyle6)->addText('$'.number_format($zone_total,2),array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right'));}$table->addRow(250,"exact");$cellStyle7=array('gridSpan' => 4,'valign'=>'center');$table->addCell(8500,$cellStyle7)->addText('');$cellStyle7=array('gridSpan' => 3,'bgColor'=>'333333','valign'=>'center');$table->addCell(3100,$cellStyle7)->addText('Breakdown By Month',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$cellStyle7=array('valign'=>'center','bgColor'=>'333333');$table->addCell(800,$cellStyle7)->addText('Month',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$table->addCell(800,$cellStyle7)->addText('Spots',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$table->addCell(800,$cellStyle7)->addText('Cost',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));if(isset($proposalLines['brodmonthstotal']) && !empty($proposalLines['brodmonthstotal'])){    foreach($proposalLines['brodmonthstotal'] as $yearKey => $yearTotal){        foreach($yearTotal as $monthValue){            $table->addRow(250,"exact");            $cellStyle7=array('gridSpan' => 7,'valign'=>'center');            $table->addCell(11600,$cellStyle7)->addText('');            $cellStyle7=array('valign'=>'center');            $table->addCell(800,$cellStyle7)->addText($monthValue['monthnumber'].'-'.substr($yearKey,2,2),array('bold'=>true,'name' => 'Calibri', 'size'=>10,'color'=>'000000'),array('align'=>'center'));            $table->addCell(800,$cellStyle7)->addText($monthValue['spotsmonth'],array('bold'=>true,'name' => 'Calibri', 'size'=>10,'color'=>'000000'),array('align'=>'center'));            $table->addCell(800,$cellStyle7)->addText('$'.number_format($monthValue['monthtotal'],2),array('bold'=>true,'name' => 'Calibri', 'size'=>10,'color'=>'000000'),array('align'=>'center'));        }    }}//Gross Total$table->addRow(250,"exact");$cellStyle=array('gridSpan' => 7,'valign'=>'center');$table->addCell(11600,$cellStyle)->addText('');$cellStyle=array('valign'=>'center');$table->addCell(800,$cellStyle)->addText('Gross',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$cellStyle = array('gridSpan' => 2,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');$table->addCell(800,$cellStyle)->addText('$'.number_format($monthValue['nettotal'],2),array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right','spaceAfter' => 0));//Net Total$table->addRow(250,"exact");$cellStyle=array('gridSpan' => 6,'valign'=>'center');$table->addCell(11600,$cellStyle)->addText('');$cellStyle=array('gridSpan' => 2,'valign'=>'center');$table->addCell(800,$cellStyle)->addText('Net Total',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right','spaceAfter' => 0));$cellStyle = array('gridSpan' => 2,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');$table->addCell(800,$cellStyle)->addText('$'.number_format($monthValue['nettotal'],2),array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right','spaceAfter' => 0));//Signature and Date$table->addRow(250,"exact");$cellStyle=array('valign'=>'center');$table->addCell(1300,$cellStyle)->addText('Signature',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$cellStyle=array('gridSpan' => 5,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');$table->addCell(9500,$cellStyle)->addText('');$cellStyle=array('valign'=>'center');$table->addCell(800,$cellStyle)->addText('');$cellStyle=array('valign'=>'center');$table->addCell(800,$cellStyle)->addText('Date',array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'center','spaceAfter' => 0));$cellStyle = array('gridSpan' => 2,'valign'=>'center','borderBottomSize'=>3,'borderBottomColor','D2D2D2');$table->addCell(1600,$cellStyle)->addText(date('m-d-Y'),array('bold'=>true,'name' => 'Calibri', 'size'=>10),array('align'=>'right','spaceAfter' => 0));// Save File$objWriter = PHPWord_IOFactory::createWriter($objWord, 'Word2007');$excelLocation = str_replace('word_report.php', 'word/', __FILE__);$objWriter->save($excelLocation.'word_report_'.$_GET['proposalid'].'.docx');// Download fileecho $file = $excelLocation.'word_report_'.$_GET['proposalid'].'.docx';if (file_exists($file)) {    header('Content-Description: File Transfer');    header('Content-Type: application/octet-stream');    header('Content-Disposition: attachment; filename='.basename($file));    header('Content-Transfer-Encoding: binary');    header('Expires: 0');    header('Cache-Control: must-revalidate');    header('Pragma: public');    header('Content-Length: ' . filesize($file));    ob_clean();    flush();    readfile($file);    exit;}?>