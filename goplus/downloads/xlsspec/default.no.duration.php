<?php	$styleHead1 = array(    'font'  => array(        'bold'  => true,        'color' => array('rgb' => '003366'),        'size'  => 14,        'name'  => 'Arial'    ));    $styleHead2 = array(        'font'  => array(                'color' => array('rgb' => 'FFFFFF'),                'size'  => 9,                'name'  => 'Arial'));$styleTZ = array(        'font'  => array(                'color' => array('rgb' => '333333'),                'size'  => 8,                'name'  => 'Arial'));$styleBorderLines = array(           	'style' => PHPExcel_Style_Border::BORDER_THIN,           	'color' => array('rgb' => 'CCCCCC'));// create PHPExcel object$objExcel 		= new PHPExcel();// Set document properities$objExcel->getProperties()->setCreator("Excel Export")         ->setLastModifiedBy("VAST")         ->setTitle("ShowSeeker")         ->setSubject("Report")         ->setDescription("Proposal XLSX");// page settings$sheet = $objExcel->getActiveSheet();//Centering Page Contents$sheet->getStyle( $sheet->calculateWorksheetDimension() )->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER); $sheet->getPageSetup()->setOrientation(PHPExcel_Worksheet_PageSetup::ORIENTATION_LANDSCAPE);$sheet->getPageSetup()->setPaperSize(PHPExcel_Worksheet_PageSetup::PAPERSIZE_LETTER);$sheet->getPageSetup()->setRowsToRepeatAtTopByStartAndEnd(1, 4);$pageMargins = $sheet->getPageMargins();$margin = 0.6 / 2.54;$pageMargins->setTop($margin);$pageMargins->setBottom($margin);$pageMargins->setLeft($margin);$pageMargins->setRight($margin);// Set active sheet index to the first sheet$objExcel->setActiveSheetIndex(0);// Assing style to header text$objRichText = new PHPExcel_RichText();$logo = trim($proposalLines['corporation'][0]['logo']);$imgPath = str_replace('/services/downloads','',getcwd());$logo = str_replace('http://ww2.showseeker.com',$imgPath.'/showseeker', $logo);$proposalinfo = trim($proposalLines['proposalinfo']['name']);$objExcel->getActiveSheet()->mergeCells('A1:F1');$objExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);$objExcel->getActiveSheet()->getStyle('A1:F1')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);$objExcel->getActiveSheet()->setCellValue('A1',$proposalinfo);$objExcel->getActiveSheet()->getStyle('A1')->applyFromArray($styleHead1);$objExcel->getActiveSheet()->getRowDimension(1)->setRowHeight(60);$objExcel->getActiveSheet()->getStyle('A1')->getAlignment()->setWrapText(true);// Display Corporation Logo$objExcel->getActiveSheet()->mergeCells('G1:K1');$objDrawing = new PHPExcel_Worksheet_Drawing();$objDrawing->setPath($logo);$objDrawing->setHeight(80);$objDrawing->setWidth(180);$objDrawing->setCoordinates('G1');$objDrawing->setOffsetX(1);$objDrawing->setWorksheet($objExcel->getActiveSheet());$objExcel->getActiveSheet()->getStyle('G1:K1')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_RIGHT);$objExcel->getActiveSheet()->getStyle('G1:K1')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_BOTTOM);$objExcel->getActiveSheet()->setCellValue('G1', ucwords (strtolower($arrProposal[0]['zone']['timezonename'] )).' Time');$objExcel->getActiveSheet()->getStyle('G1')->applyFromArray($styleTZ);// Set bottom border to header row$objExcel->getActiveSheet()->getStyle('A1:K1')->getBorders()->getBottom()->setBorderStyle(PHPExcel_Style_Border::BORDER_THIN);$objExcel->getActiveSheet()->getHeaderFooter()->setOddFooter('Page &P / &N');$objExcel->getActiveSheet()->getHeaderFooter()->setEvenFooter('Page &P / &N');// Set columns heading with grey background$objExcel->getActiveSheet()->getRowDimension(2)->setRowHeight(25);$objExcel->getActiveSheet()->getStyle('A2:K2')->applyFromArray($styleHead2);$objExcel->getActiveSheet()->getStyle('A2:K2')->getFill()->applyFromArray(array('type' => PHPExcel_Style_Fill::FILL_SOLID,'startcolor' => array('rgb' => '003366')));$objExcel->getActiveSheet()->getStyle('A2:K2')->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);$objExcel->getActiveSheet()->getStyle('A2:K2')->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);$objExcel->getActiveSheet()->setCellValue('A2','Net');$objExcel->getActiveSheet()->setCellValue('B2','Program');$objExcel->getActiveSheet()->setCellValue('C2','Episode');$objExcel->getActiveSheet()->setCellValue('D2','Description');$objExcel->getActiveSheet()->setCellValue('E2','Day');$objExcel->getActiveSheet()->setCellValue('F2','Airdate');$objExcel->getActiveSheet()->setCellValue('G2',"Starts");$objExcel->getActiveSheet()->setCellValue('H2','Ends');$objExcel->getActiveSheet()->setCellValue('I2',"AirStyle");$objExcel->getActiveSheet()->setCellValue('J2','Genre');$objExcel->getActiveSheet()->setCellValue('K2','Genre2');// FreezePane rows (Assign vertical scrolling from this column and row)$objExcel->getActiveSheet()->freezePane('A3');$row = 2;// Printing actual proposal data (Zone wise)foreach($arrProposal as $proposalKey => $proposalValue) {    $zone_row = $row;        foreach($proposalValue['lines'] as $zoneKey => $zoneValue){                $row++;                $objExcel->getActiveSheet()->getRowDimension($row)->setRowHeight(-1);                $objExcel->getActiveSheet()->getStyle('A'.$row.':'.'K'.$row)->applyFromArray(array('font'  => array('color' => array('rgb' => '000000'),'size'  => 8, 'name'  => 'Arial')));        $objExcel->getActiveSheet()->getStyle('A'.$row.':'.'K'.$row)->getBorders()->getBottom()->applyFromArray($styleBorderLines);        $objExcel->getActiveSheet()->getStyle('A'.$row.':'.'K'.$row)->getAlignment()->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_CENTER);        $objExcel->getActiveSheet()->getStyle('A'.$row.':'.'K'.$row)->getAlignment()->setVertical(PHPExcel_Style_Alignment::VERTICAL_CENTER);		//CALLSIGN        $objExcel->getActiveSheet()->getColumnDimension('A')->setWidth(7);		$objExcel->getActiveSheet()->setCellValue('A'.$row, $zoneValue['callsign']);		  		//PROGRAM TITLE		$title 			= $zoneValue['title'];		$thesetitles	= explode(',',$title);				if(count($thesetitles) > 5){			$title = $thesetitles[0].', '.$thesetitles[1].', '.$thesetitles[2].', '.$thesetitles[3].', '.$thesetitles[4].', moreâ€¦';		} 		  	          $objExcel->getActiveSheet()->getColumnDimension('B')->setWidth(22);			$objExcel->getActiveSheet()->setCellValue('B'.$row, $title);		$objExcel->getActiveSheet()->getStyle('B'.$row)->getAlignment()->setWrapText(true)->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);		//EPISODE		$objRichText = new PHPExcel_RichText();		$episodetitle = '';		if($zoneValue['epititle'] != ''){			$episodetitle = $zoneValue['epititle'];			$objCellEpisode = $objRichText->createTextRun($episodetitle);			$objCellEpisode->getFont()->setName('Arial')->setSize(8)->setColor( new PHPExcel_Style_Color( '003366'));			}		        $objExcel->getActiveSheet()->getColumnDimension('C')->setWidth(22);		$objExcel->getActiveSheet()->setCellValue('C'.$row, $objRichText);		$objExcel->getActiveSheet()->getStyle('C'.$row)->getAlignment()->setWrapText(true)->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);		  		//DESCRIPTION		$showDescription = $zoneValue['desc'];        $objExcel->getActiveSheet()->getColumnDimension('D')->setWidth(27);		$objExcel->getActiveSheet()->setCellValue('D'.$row, $showDescription);		$objExcel->getActiveSheet()->getStyle('D'.$row)->getAlignment()->setWrapText(true)->setHorizontal(PHPExcel_Style_Alignment::HORIZONTAL_LEFT);		//WEEK DAYS        $days 		= isset($zoneValue['dayFormat']) ? $zoneValue['dayFormat'] : '';        $dayPart 	= trim($days);        $objExcel->getActiveSheet()->getColumnDimension('E')->setWidth(5);		$objExcel->getActiveSheet()->setCellValue('E'.$row, $dayPart);		$objExcel->getActiveSheet()->getStyle('E'.$row)->getAlignment()->setWrapText(true);		//AIR DATE        $objExcel->getActiveSheet()->getColumnDimension('F')->setWidth(8);        $objExcel->getActiveSheet()->setCellValue('F'.$row, date('n-j-y',strtotime($zoneValue['startdate'])));		$objExcel->getActiveSheet()->getStyle('F'.$row)->getNumberFormat()->setFormatCode(PHPExcel_Style_NumberFormat::FORMAT_DATE_DMYMINUS);		//START TIME        $objExcel->getActiveSheet()->getColumnDimension('G')->setWidth(7);        $objExcel->getActiveSheet()->setCellValue('G'.$row,str_replace('M','',str_replace(':00','',date ('g:iA',strtotime($zoneValue['starttime'])))) );        		//END TIME        $objExcel->getActiveSheet()->getColumnDimension('H')->setWidth(7);        $objExcel->getActiveSheet()->setCellValue('H'.$row,str_replace('M','',str_replace(':00','',date ('g:iA',strtotime($zoneValue['endtime'])))) );                //AIR STYLE        $objRichText = new PHPExcel_RichText();		  					//PREMIERES FLAG		$premieres = $zoneValue['premiere'];				if($premieres != ''){			  if($premieres == 'Premiere'){		  	  $premieres = "Movie Premiere";			  }		  $objCellPremiere = $objRichText->createTextRun($premieres);		  $objCellPremiere->getFont()->setName('Arial')->setSize(8)->setItalic(true)->setColor( new PHPExcel_Style_Color( PHPExcel_Style_Color::COLOR_RED ));		}				//NEW FLAG		elseif($zoneValue['live'] == 'Live'){			$objCellLive = $objRichText->createTextRun('Live');			$objCellLive->getFont()->setName('Arial')->setSize(8)->setColor( new PHPExcel_Style_Color( '660066'));		  		}		//NEW FLAG		elseif($zoneValue['premiere'] == '' && $zoneValue['isnew'] == 'New' && $includenew != 'false'){			$objCellNew = $objRichText->createTextRun($zoneValue['isnew']);			$objCellNew->getFont()->setName('Arial')->setSize(8)->setColor( new PHPExcel_Style_Color( PHPExcel_Style_Color::COLOR_DARKGREEN ));		  		}						$objExcel->getActiveSheet()->getColumnDimension('I')->setWidth(8);		$objExcel->getActiveSheet()->setCellValue('I'.$row, $objRichText);		$objExcel->getActiveSheet()->getStyle('I'.$row)->getAlignment()->setWrapText(true);                        //GENRE        $objExcel->getActiveSheet()->getColumnDimension('J')->setWidth(10);        $objExcel->getActiveSheet()->setCellValue('J'.$row,$zoneValue['genre']);		$objExcel->getActiveSheet()->getStyle('J'.$row)->getAlignment()->setWrapText(true);                		//GENRE 2		$genre2 = '';				if(isset($zoneValue['genre2']))			$genre2 = $zoneValue['genre2'];			        $objExcel->getActiveSheet()->getColumnDimension('K')->setWidth(10);        $objExcel->getActiveSheet()->setCellValue('K'.$row,$genre2); 		$objExcel->getActiveSheet()->getStyle('K'.$row)->getAlignment()->setWrapText(true);                   }    $row ++;}// Create and Save file$objWriter = new PHPExcel_Writer_Excel2007($objExcel);$pslFileName = cleanStr($proposalinfo);$objWriter->save('/var/www/html/showseeker/files/tmp/'.$pslFileName.'.xlsx');echo '{"filename":"'.$pslFileName.'.xlsx"}';exit;?>