<?php		ini_set('display_errors', 0);	ini_set('display_startup_errors', 0);	$id     		= $_GET['proposalid'];	$userId			= trim(urldecode($_GET['user']));	$apiKey			= trim(urldecode($_GET['token']));	$proposal  		= getProposalMedia($id, $userId, $apiKey);		$proposalMedia  = $proposal->media;	$utoken			= 0;	$ids  			= array();	$nets 			= array();	$titles  		= array();	$movies 		= array();	$tv 			= array();	foreach ($proposalMedia->SH as &$value){			array_push($nets, array(rtrim($value->showId,' ,'), $value->stationId));		array_push($titles, $value->title);		$array = array(		    "url" 		=> $value->cover,		    "title" 	=> $value->title,		    "showid" 	=> $value->showId.'0000',		    "stationId" => $value->stationId,		    "trailer" 	=> $value->trailer		);		array_push($tv, $array);	}			foreach ($proposalMedia->SP as &$value){			array_push($nets, array(rtrim($value->showId,' ,'), $value->stationId));		array_push($titles, $value->title);		$array = array(		    "url" 		=> $value->cover,		    "title" 	=> $value->title,		    "showid" 	=> $value->showId.'0000',		    "stationId" => $value->stationId,		    "trailer" 	=> $value->trailer		);		array_push($tv, $array);	}	foreach ($proposalMedia->MV as &$value){			array_push($nets, array(rtrim($value->showId,' ,'), $value->stationId));		array_push($titles, $value->title);		$array = array(		    "url" 		=> $value->cover,		    "title" 	=> $value->title,		    "showid" 	=> $value->showId.'0000',		    "stationId" => $value->stationId,		    "trailer" 	=> $value->trailer		);		array_push($movies, $array);	}		$imagesCounter = 0;			function getProposalMedia($id, $userId, $apiKey) {				$curl = curl_init();		curl_setopt_array($curl, array(			CURLOPT_URL => "https://plusapi.showseeker.com/proposal/media/{$id}",			CURLOPT_RETURNTRANSFER => true,			CURLOPT_ENCODING => "",			CURLOPT_MAXREDIRS => 10,			CURLOPT_TIMEOUT => 180,			CURLOPT_SSL_VERIFYHOST=> false,			CURLOPT_SSL_VERIFYPEER=> false,			CURLOPT_HTTP_VERSION => CURL_HTTP_VERSION_1_1,			CURLOPT_CUSTOMREQUEST => "GET",			CURLOPT_POSTFIELDS => "",			CURLOPT_HTTPHEADER => array(			"api-key: {$apiKey}",			"cache-control: no-cache",			"user: {$userId}"			),		));			$response = curl_exec($curl);		$err      = curl_error($curl);		curl_close($curl);		return json_decode($response);	}?><html><head></head><body>			<div class="controlsHeader">		<table width="100%">			<tr>				<td width="33%" align="center" valign="middle">					<span id="numberOfLines">						<label style="font-size:10pt;">Number of lines per Slide:</label>						<select id="linesnum" name="linesnum">							<option value="7">7</option>							<option value="8" selected="selected">8</option>							<option value="9">9</option>							<option value="10">10</option>							<option value="11">11</option>							<option value="12">12</option>						</select>					</span>										</td>													<td width="33%" align="center" valign="middle">					<span id="showDescLines">						<label style="font-size:10pt;">Include Program Description? </label>						<input type="radio" value="Y" name="linedescription" id="linedescriptionY" checked="checked"><label style="font-size:10pt;" id="lbl-linedescriptionY">Yes</label>						<input type="radio" value="N" name="linedescription" id="linedescriptionN"><label  style="font-size:10pt;" id="lbllinedescriptionN">No</label>						</span>									</td>								<td width="33%" align="center" valign="middle">					<div class="btn-blue ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only" style="display: none">						<span class="ui-button-text" id="pptAddAll">Add All</span>					</div>					<div class="btn-green ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">						<span class="ui-button-text" id="ppt">Download</span>					</div>					<div class="btn-red ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only">						<span class="ui-button-text" id="reset">Reset</span>					</div>				</td>			</tr>			</table>	</div>	<div>		<table width="100%">			<tr>				<td width="72%" valign="top">					<div style="width: 100%">						<b style="font-size:12pt;">Available Images:</b>						<br />						<smaller><i style="color:#666;">Select up to 18 of the images below to export into the Presentation</i></smaller>					</div>					</td>				<td width="3%"></td>				<td valign="top" width="25%">					<div style="width: 100%">						<b style="font-size:12pt;">Selected Images:</b>						<br />						<smaller><i>Images Added: <span id="addedImages"></span></i></smaller>					</div>					</td>			</tr>		</table>				<table width="100%" style="height: 435px;">			<tr>				<td width="72%" valign="top">					<div style="height: 430px; overflow-x: hidden; overflow-y: scroll; width: 100%;">							<?php if(count($tv) > 0): ?>													<div class="image">								<b style="font-size:10pt;">TV Shows</b>							</div>												<br style="clear:both;">																<?php foreach ($tv as &$value):?>														<div class="image">									<img onmouseover="this.style.cursor='pointer'" class="tvimg" width="105" src="<?php print $value['url']; ?>">									<center>										<input type="checkbox" id="<?php print $value['showid'].$imagesCounter;?>" value="<?php print $value['showid'];  $imagesCounter = $imagesCounter+1;?>" name="pptImages" style="display:none;">										<span id="<?php print $value['stationId'];?>" name="<?php if($value['trailer'] !== ''){print $value['trailer'];}?>"></span>									</center>								</div>							<?php endforeach; $imagesCounter = 0;?>												<?php endif;?>										<br style="clear:both;">														<?php if(count($movies) > 0): ?>												<div class="image">								<b style="font-size:10pt;">Movies</b>							</div>													<br style="clear:both;">																<?php foreach ($movies as &$value):?>								<div class="image"><img onmouseover="this.style.cursor='pointer'" width="105" class="mvimg" src="<?php print $value['url']; ?>">									<center>										<input type="checkbox" id="<?php print $value['showid'].$imagesCounter; $imagesCounter = $imagesCounter+1;?>" value="<?php print $value['showid']; ?>" name="pptImages" style="display:none;">										<span id="<?php print $value['stationId'];?>" name="<?php if($value['trailer'] !== ''){print $value['trailer'];}?>"></span>									</center>								</div>							<?php endforeach;?>						<?php endif; ?>					</div>				</td>				<td width="3%"></td>				<td valign="top" width="25%">					<div id="selectedImg" class="queue"></div>				</td>			</tr>		</table>	</div></body><script>		$("button").button();			var imagecount = 0;		var shows 		= [];	var images 		= [];	var trailers 	= [];	var stations 	= [];	var pairs 		= [];		var imgCount = <?php echo count($tv)+count($movies)?>;			$(document).ready(function(){		$("#dialog-window").dialog("destroy");				$('#waitmsg').hide();				$('#linesnum').change(function(){			if(parseInt($(this).val()) > 9){				$('#linedescriptionN').prop('checked',true);				$('#linedescriptionY').prop('checked',false);				$('#linedescriptionY,#lbl-linedescriptionY').hide();			}			else{				$('#linedescriptionY').prop('checked',true);				$('#linedescriptionN').prop('checked',false);				$('#linedescriptionY,#lbl-linedescriptionY').show();			}		});				if(corpid === 5){			$('#linesnum').val(7);		}				if( imgCount < 17){			$('#pptAddAll').parent('div').toggle();		}			});				// Shows / Hides download options		$('input[name="version"]').click(function(){		pptver = $('input[name="version"]').val();				if($(this).val() == 'Regular'){			$('#numberOfLines, #showDescLines').show();			$('#showLines').hide();		}				if($(this).val() == 'Summary'){			$('#numberOfLines, #showDescLines').hide();			$('#showLines').show();		}	});	// Counts the number of images and save the urls into an array    $('.mvimg,.tvimg').click(function(){		var thisDiv = $(this).closest('div');		var thisBox = $(this).closest('div').find("input:checkbox");		var positionImg 	=	$.inArray(thisBox.attr('value') , images);			var thisImageId   	= thisBox.attr('id');  		var thisImageURL  	= thisBox.closest('div').find('img').attr('src');  		var thisTrailerURL	= thisBox.closest('div').find('span').attr('name');  		var thisStationID 	= thisBox.closest('div').find('span').attr('id');	         		var thisClass 		= $(this).attr('class').substr(0, 2);  				if(! thisBox.prop("checked")){			if(imagecount >= 18){				return false;			}			var tmpMedia;			var tmpStation;						thisBox.prop("checked", true); 			thisDiv.css({'background-color':'#5FE744'});				      			/* looping to find images with the same IDs */			$(':input[value="'+thisBox.attr("value")+'"]:checked').each(function(){							if(thisBox.attr('id') != thisImageId){					thisBox.removeAttr("checked");					legacyImage = thisBox.closest('div').find('img').attr('src');								positionImg = jQuery.inArray(legacyImage, images);					if(positionImg != -1){												$('#img'+thisImageId).remove();						images.splice(positionImg,1);						stations.splice(positionImg,1);						trailers.splice(positionImg,1);						pairs.splice(positionImg,1);						imagecount --;					}				}				else{								if(thisStationID !== '' && thisStationID !== ' '){											tmpMedia 	= {};						tmpStation 	= {};												$('#selectedImg').append('<div id=img'+thisImageId+' align=center style="margin:4px; width:44px; background-color: #FFFFFF; border-radius: 4px; height:auto; float:left;"><img src='+thisImageURL+' width=40 height=60></div>' );						stations.push(thisStationID);							trailers.push(thisTrailerURL);						images.push(thisImageURL);						tmpMedia['cover'] 			= thisImageURL;						tmpMedia['trailer'] 		= thisTrailerURL;						tmpMedia['showType'] 		= thisClass;						tmpStation[thisStationID] 	= tmpMedia						pairs.push(tmpStation);						imagecount ++;					}				}						});      }      else{			thisBox.prop("checked", false);						positionImg = $.inArray(thisImageURL, images);			thisDiv.css({'background-color':'white'});			var thisImageId   = thisBox.attr('id');	  			$('#img'+thisImageId).remove();			images.splice(positionImg, 1);			stations.splice(positionImg,1);			pairs.splice(positionImg,1);			imagecount --;	   	}	   		if(imagecount>=18){			$(":checkbox").not(":checked").attr("disabled", true);		}		else{			$(":checkbox").not(":checked").removeAttr("disabled");		}				if(imagecount > 0){			$('#addedImages').text(imagecount); 		}		else{			$('#addedImages').text('0');		}		    });		$('#ppt').click(function(){			// removing previous interface		closeAllDialogs();			removelegacy();		if(issaving){			downloadtype = 'ppt';			return;		}		if(proposalid == 0){			loadDialogWindow('noproposalloaded', 'ShowSeeker Plus', 450, 180, 1);			return;		}		if($('input[name="version"]:checked').val() == 'Summary'){			pptver	= 1;		}		else{			pptver	= 0;		}		var url;		var inLines 			= $('input[name="linedetails"]:checked').val();		var inDesc 				= $('input[name="linedescription"]:checked').val();		var numberOfLines		= $("#linesnum").val();		var x 					= buildDownloadPPTURL();		var videoAndTrailers 	=  encodeURIComponent(JSON.stringify(pairs));				if(corpid !== 15 && corpid !== 46){			url = 'https://plus.showseeker.com/goplus/downloads/ppt.php'+x+'&assets='+videoAndTrailers+'&onlysummary='+pptver;		}		else{			url = 'https://plus.showseeker.com/goplus/downloads/ppt.sr.php'+x+'&assets='+videoAndTrailers+'&onlysummary='+pptver;		}		url = url+'&numberOfLines='+numberOfLines+'&includeLines='+inLines+'&includeDesc='+inDesc+'&externalcall=1';			$("#dialog-window").dialog({			width:260,			height:180,			modal: true,			resizable: false,			dialogClass: "pepper",			open: function(event, ui){				$('#dialog-window').html('<br /><center><H3>Preparing Download... Please Wait</H3><br /><img src="i/ajax.gif"></center>');}		});		$.ajax({	        type:'get',			url: url,	        async:false,	        success:function(data){		        				$("#dialog-window").dialog("destroy");				window.location.href = 'services/fdownload.php?filename='+data;				logUserEvent(49,'PPT',1,proposalid);				try{					var pslInfo = datagridProposalManager.getProposalInfo(proposalid);					var mixType	= 'PPT';					var d 		= buildMixDownloadParams(mixType, pslInfo.name, data.filename);					usrIp('Download',d);				}catch(e){}	        }		});		/*$.post("services/download.eclipse.php", {url:url},function(data) {		$("#dialog-window").dialog("destroy");			window.location.href = 'services/fdownload.php?filename='+data;			logUserEvent(49,'PPT',1,proposalid);			try{				var pslInfo = datagridProposalManager.getProposalInfo(proposalid);				var mixType	= 'PPT';				var d 		= buildMixDownloadParams(mixType, pslInfo.name, data.filename);				usrIp('Download',d);			}catch(e){}		});*/	});		$('#pptAddAll').click(function(){				var thisDiv,thisBox,thisImageId,thisImageURL,positionImg,thisStationID,thisTrailerURL,thisClass;				$("input[name=pptImages]").each(function(i,item){			thisDiv 		= $(item).closest('div');			thisBox 		= thisDiv.find("input:checkbox");			thisImageURL  	= thisBox.closest('div').find('img').attr('src');			thisStationID 	= thisBox.closest('div').find('span').attr('id');			thisTrailerURL	= thisBox.closest('div').find('span').attr('name');			thisClass 		= $(item).closest('div').find('img').attr('class').substr(0, 2);			thisImageId   	= thisBox.attr('id');			positionImg 	= $.inArray(thisImageURL, images);						if(positionImg === -1){				thisImageId   	= thisBox.attr('id');				thisBox.prop("checked", true);	  				thisDiv.css({'background-color':'#5FE744'});				$('#selectedImg').append('<div id=img'+thisImageId+' align=center style="margin:4px; width:44px; background-color: #FFFFFF; border-radius: 4px; height:auto; float:left;"><img src='+thisImageURL+' width=40 height=60></div>' );				stations.push(thisStationID);					trailers.push(thisTrailerURL);				images.push(thisImageURL);				tmpMedia 		= {};				tmpStation 		= {};				tmpMedia['cover'] 			= thisImageURL;				tmpMedia['trailer'] 		= thisTrailerURL;				tmpMedia['showType'] 		= thisClass;				tmpStation[thisStationID] 	= tmpMedia				pairs.push(tmpStation);				imagecount ++;			}					});			if(imagecount > 0){ 				$('#addedImages').text(imagecount); 			}			else{ 				$('#addedImages').text('0');			}					});			$('#reset').click(function(){				var thisDiv,thisBox,thisImageId,thisImageURL,positionImg;				$( "input[name=pptImages]:checked").each(function(i,item){			$(item).val()			thisDiv 		= $(item).closest('div');			thisBox 		= thisDiv.find("input:checkbox");			thisImageURL  	= thisBox.closest('div').find('img').attr('src');			thisImageId   	= thisBox.attr('id');			positionImg 	= $.inArray(thisImageURL, images);			thisImageId   	= thisBox.attr('id');						thisBox.prop("checked", false);	  			thisDiv.css({'background-color':'white'});			$('#img'+thisImageId).remove();						images.splice(positionImg, 1);			stations.splice(positionImg,1);			pairs.splice(positionImg,1);			imagecount --;		});				if(imagecount > 0){ 			$('#addedImages').text(imagecount); 		}		else{ 			$('#addedImages').text('0');		}				$('#linesnum').val(8).change();	});				function removelegacy(){		$("#dialog-image-ppt-selector").dialog("close");		$("#dialog-download-file").dialog("destroy");		$("#dialog-download-file #preparing-download-dialog").remove();				$("#dialog-download-file #preparing-download-dialog-finished").remove();		return ;	}					function downloadPPTFile(url){			$('#dialog-download-file').load(url, function() {			$("#dialog-download-file").dialog("destroy");			$("#dialog-download-file").dialog({				width:250,				height:180,				modal: true,				resizable: false,				dialogClass: "pepper"			});		});	}				function buildDownloadPPTURL(){		var sort1 			= $("#download-sort-1").val();		var sort2 			= $("#download-sort-2").val();		var sort3 			= $("#download-sort-3").val();		var logos 			= $("#download-include-logos").prop("checked");		var description 	= $("#download-include-description").prop("checked");		var includenew 		= $("#download-include-new").prop("checked");		var hidwerates 		= $("#download-hide-rates").prop("checked");		var showrates 		= $("#download-show-rates").prop("checked");		var onlyfixed 		= $("#download-only-fixed").prop("checked");		var addterms 		= $("#download-add-terms").prop("checked");		var calendar 		= $("#standard").prop("checked");				var numberOfLines	= $("#linesnum").val();			var re = '?proposalid='+proposalid;		re = re + '&userid='+userid;		re = re + '&tokenid=<?php print $utoken?>';		re = re + '&clientid='+clientid;		re = re + '&headerid='+headerid;		re = re + '&sort1='+sort1;		re = re + '&sort2='+sort2;		re = re + '&sort3='+sort3;		re = re + '&logos='+logos;		re = re + '&description='+description;		re = re + '&includenew='+includenew;		re = re + '&hiderates='+hidwerates;		re = re + '&showratecard='+showrates;		re = re + '&onlyfixed='+onlyfixed;		re = re + '&addterms='+addterms;		re = re + '&repfirmid='+repfirmid;		re = re + '&agencyid='+agencyid;		re = re + '&calendar='+calendar;			return re;	}</script>