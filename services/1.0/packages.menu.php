<?phpini_set('display_errors', 0);	$userid 		= $_GET['userid'];	$authtokin 	= $_GET['tokenid'];	//if there is anything blank return an error	if(empty($authtokin) || empty($userid)){		exit('error');	}	//include the classes and the database	include_once('../../config/mysqli.php');	//Authentication	require_once('../../classes/Auth.php');	$auth = new Auth($con2);	$url = $_SERVER['PHP_SELF'];	$key = $auth->checkAuthGoplus($url,$authtokin,$userid);	if(!$key){		print "Access denied - You are not authorized to access this page.";		exit;	}		//set the token id for the user	$tokenid = $key;	$dbHost		= 'db5.showseeker.net';	$dbUserName	= 'vastdb';	$dbPassWord	= 'VastPlus#01';	$dbName		= 'showseeker';	$cnn = mysqli_connect($dbHost,$dbUserName,$dbPassWord,$dbName);	if (mysqli_connect_errno()){	  echo "Failed to connect to MySQL: " . mysqli_connect_error();	}	$sql = "	SELECT 	packageid, 							name, 							active, 							deleted, 							created, 							updated,							CASE 							WHEN u IS NULL OR u < c THEN DATE_FORMAT(c, '%m/%d/%Y') 							ELSE DATE_FORMAT(u, '%m/%d/%Y') 							END AS latest,							stationnum 				FROM 	(														SELECT 		packageid,										packages.name,										packages.active,										DATE_FORMAT(MAX(programDataProjected.deletedat), '%m/%d/%Y') as deleted,										DATE_FORMAT(MAX(programDataProjected.createdat), '%m/%d/%Y') as created,										DATE_FORMAT(MAX(programDataProjected.updatedat), '%m/%d/%Y') as updated,										MAX(programDataProjected.createdat) as c,										MAX(programDataProjected.updatedat) as u,										stationnum							FROM		programDataProjected							INNER JOIN	packages							ON			programDataProjected.packageid = packages.id							WHERE 		packageid is not null and packageid > 0							AND 		programDataProjected.deletedat is null							AND			packages.deletedat is null							AND			packages.active = 1											AND 		programDataProjected.createdat is not null							GROUP BY 	packageid,stationnum) UPDATES							ORDER BY 	name asc, latest desc";	$result = mysqli_query($cnn, $sql);		$data = array();	$fdata = array();			if($result->num_rows != 0){		while ($row = $result->fetch_assoc()) {			$data[] = $row;		}				$pcks = array();    			foreach ($data as $val) {			$pcks[] = $val['packageid'];		}		$pcks = array_unique($pcks);				$n = 0;		$pos = 0;		foreach ($pcks as $packageid) {			$netsbypck 		= array();			$lastupdate 	= strtotime("2015-01-01 00:00:00.0");			$currentupdate 	= 0;						foreach($data as $row){								$currentupdate = strtotime($row['latest']);								if($row['packageid'] == $packageid){					$netsbypck[]=$row['stationnum'];					$n	= $pos;					if($lastupdate < $currentupdate ) {						$lastupdate	= $currentupdate;							}									}								$pos++;			}						$fdata[] = array('packageid'=>$data[$n]['packageid'],'name'=>$data[$n]['name'],'latest'=>date('m-d-Y',$lastupdate),'active'=>$data[$n]['active'], 'created'=>$data[$n]['created'],'updated'=>$data[$n]['updated'],'deleted'=>$data[$n]['deleted'],'stations'=>$netsbypck);						$pos = 0;		} 	} 	print json_encode($fdata);?>