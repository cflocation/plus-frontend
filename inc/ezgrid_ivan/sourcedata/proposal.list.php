<?php//%m/%d/%Y %Y%m/%d	$userid = $_GET['userid'];	$tokenid = $_GET['tokenid'];		include_once('database.php');		$sql = "		SELECT		proposals.id, 		proposals.name, 		proposals.total, 		proposals.zones, 		proposals.lines,		proposals.proposal,		proposals.spots, 		proposals.discountid, 		proposals.amount,		DATE_FORMAT(proposals.createdat, '%Y/%m/%d') AS created,		DATE_FORMAT(proposals.updatedat, '%Y/%m/%d') AS updatedat		FROM users INNER JOIN proposals ON users.id = proposals.userid		WHERE users.id = {$userid} AND users.tokenid = '{$tokenid}' AND proposals.deletedat IS NULL		ORDER BY proposals.createdat DESC	";		$rows = array();		$result = mysql_query($sql);		while ($row = mysql_fetch_assoc($result)) {		$stats = parseJsonToStats($row['proposal']);				$r = array();				$r['id'] = $row['id'];		$r['name'] = urldecode($row['name']);		$r['spots'] = $stats['spots'];		$r['lines'] = $stats['lines'];		$r['total'] = $stats['total'];		$r['zone'] = $stats['zone'];		$r['fstart'] = $stats['fstart'];		$r['fend'] = $stats['fend'];		$r['created'] = $row['created'];		$r['updatedat'] = $row['updatedat'];				//print_r($r);		    	array_push($rows,$r);	}		$array = mysql_fetch_assoc($result); 		//row count	$ttl = mysql_num_rows($result);			print_r($dates);	$header = array(    	"responseHeader" => array("count" => $ttl),    	"response" => array("proposals" => $rows)	);		$json = json_encode($header);	print_r($json);			function parseJsonToStats($data){		$proposal = json_decode($data);		$spots = 0;		$lines = 0;		$total = 0;		$zones = array();		$dates = array();				foreach ($proposal as &$value) {			$total += $value->rate*$value->spots;			$spots += $value->spots;			$lines += 1;						$x = date('Ymd', strtotime($value->startdate));			$xl = date('m/d/Y', strtotime($value->startdate));			$xe = date('Ymd', strtotime($value->enddate));			$xle = date('m/d/Y', strtotime($value->enddate));			$dates[$x] = $xl;			$dates[$xe] = $xle;			array_push($zones,$value->zone);		}				$zones1 = array_unique($zones);				asort($zones1);				$z = implode(", ", $zones1);					ksort($dates);			$ttl = count($dates);		if($ttl == 0){			$fstart = '';			$fend = '';		}else{			$fstart = current($dates);			$fend = end($dates);		}		$re = array("spots" => $spots,"lines" => $lines,"total" => $total,"zone" => $z, "fstart" => $fstart, "fend" => $fend);		return $re;	}				?>